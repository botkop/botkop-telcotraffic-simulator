Telco Traffic Simulator
=======================

The application simulates imaginary mobile telco traffic.
It can publish to multiple brokers, including kafka, sockets, and simple logging.
The metrics generated by the celltowers are configurable, and are sampled from user defined distributions.

Vocabulary
----------
- 'traffic database' is an sqlite database residing in folder dist/. It contains celltower and subscriber information. See below.
- 'mcc' is the mobile country code, see https://en.wikipedia.org/wiki/Mobile_country_code
- 'mnc' is the mobile network code, see https://en.wikipedia.org/wiki/Mobile_country_code
- 'subscriber' is a random record taken from the traffic database table 'identities'
- 'route' is a route calculated by Google, between 2 random points within the area defined by 'mcc' and 'mnc'
- 'velocity' is the speed at which the subscribers travel, in kilometers per hour
- 'trip' is a combination of a 'subscriber', a 'route', and a 'velocity'
- 'slide' is the size of the sliding publishing window, in milliseconds. That is: how often do you want the events published.
- 'broker': where to publish the events ? See conf/application.conf.

How does it work ?
------------------
Simulations are invoked by sending a simulation request to the service.
You can launch a simulation through REST or through the web interface.
By default the web interface is accessible at http://localhost:9000/simulator.
See here for a screen shot: https://drive.google.com/file/d/0BwsZb6l5LObTZHo3R2E2bUFyMW8/view?usp=sharing
Example scripts for using the REST interface are available in the bin/ folder.

A simulation request consists of the following parameters:
- mcc
- mnc
- number of simultaneous trips
- slide size
- velocity

For each trip, a random subscriber and 2 random celltowers are picked from the database.
A request is sent to Google to calculate the route between the locations of the 2 celltowers.
The subscriber is then sent on its way along this route, at the speed defined by the velocity.

Every 'slide' milliseconds, the location and the details of the subscriber will be published to the 'subscriber-topic' of the configured broker.
At the same time, the celltower nearest to the subscriber is retrieved.
This celltower publishes its details along with a bearer id and metrics to the 'celltower-topic'.
The bearer id allows to link the subscriber to the celltower event.
The metrics are configurable in file conf/celltowers.conf.
Every metric template consists of a metric name, a mean and a standard deviation.
When a celltower event is published, a sample is taken from the gaussian distribution defined by these parameters.

Note that currently all events are published in JSON format.

Creation of traffic.db
----------------------
Before you can use the application, you need the traffic database.

To create the traffic.db database, you will need an installation of sqlite3 (see https://www.sqlite.org/ )
You will also need an API key from http://opencellid.org/
You also need wget (https://www.gnu.org/software/wget/) if you want to follow the instructions below

First, get the celltower database from opencellid.org, by executing:

bin/download_celltower_db.sh OPENCELLID_API_KEY

Note: if you have a free account with opencellid, you will only be able to do this once a day.

Now create the database, by executing:

bin/create_traffic_db.sh

Running the simulator
---------------------

You will need a Google API key from https://developers.google.com/maps/documentation/javascript/get-api-key.
Once you have they you must create a file conf/cred.conf and enter it in there:
google.api.key=YOUR_API_KEY

Before starting the application, please verify the settings in conf/application.conf.

To start the application, execute
./activator run -Dhttp.port=9000 -Dakka.remote.netty.tcp.port=2552
in the root of the checked out code.

To start more nodes, and run the application as a cluster, execute
./activator run -Dhttp.port=N -Dakka.remote.netty.tcp.port=0
(Replace N by a unique number. You could also use 0 but in development mode you need to refresh the web browser for the application to become active.)

For detailed cluster configuration, see the akka documentation at
http://doc.akka.io/docs/akka/2.4.1/scala/cluster-usage.html
and the file
conf/application.conf

Building a production distribution
----------------------------------

Prerequisites: the traffic database has been created
In the root of the checked out code, execute: 

./activator clean universal:packageZipTarball

After a while, the file target/universal/play-traffic-1.0-SNAPSHOT.tgz wil have been created.
You can copy this file to your target platform, and extract it in a working folder:

tar xvfz play-traffic-1.0-SNAPSHOT.tgz

Execute the following commands to get the server started
cd play-traffic-1.0-SNAPSHOT
bin/play-traffic -Dhttp.port=9000 -Dakka.remote.netty.tcp.port=2552

To deploy a cluster, update conf/application.conf if necessary, and execute new nodes as follows:
bin/play-traffic -Dhttp.port=0 -Dakka.remote.netty.tcp.port=0


TODO
----
see https://github.com/koen-dejonghe/play-traffic/issues

If you have ideas, please send them to
koen@fietsoverland.com

Thank you.

